<!DOCTYPE html>
<html>
	<head>
		<title>Emmet</title>
	</head>
	<body>
    https://docs.emmet.io/
    <p class="item1"><div></div></p><a href=""></a><a href=""></a>
    <p class="item2"><div></div></p><a href=""></a><a href=""></a>
    <p class="item3"><div></div></p><a href=""></a><a href=""></a>
    <p class="item4"><div></div></p><a href=""></a><a href=""></a>
    <p class="item5"><div></div></p><a href=""></a><a href=""></a>
    dl>p.item$*5>div^^a*2+(header>ul>li*2>a)
    p.item$*5>div^a*2+(header>ul>li*2>a)
    (p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))
    (p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))+(p.item>div^a*2+(header>ul>li*2>a))
		<script type="text/javascript">
			function emmet(str) {
			    str = str.replace(/#([^+>*^.\[]*)/gi, function(rs, val){return '[id="' + val + '"]'})
                    .replace(/\.([^+>*^#\[]*)/gi, function(rs, val){return '[class="' + val + '"]'}); // 将#id和.class替换为[]属性

                const tokenRegex = /(?<text>{.+?})|(?<attr>\[.+?\])|(?<group>\(.+?\))|(?<cal>[\$\@\-\d]*\*\d+)|(?<level>[\>\+\^]+)|(?<tag>[a-z1-6]+)/gi;

                let curToken, preToken = null;

                const d = document;
                let tree = d.createDocumentFragment(), currentNode = tree;

                while((curToken = tokenRegex.exec(str)) !== null){
                    let g = curToken.groups, t = curToken[0];

                    if(g.text){ // 标签，可能带有属性
                        if(preToken.groups.tag){ // 上个token为标签
                            currentNode.lastChild.appendChild(d.createTextNode(t.substr(1, t.length - 2)));
                        }else{
                            currentNode.appendChild(d.createTextNode(t.substr(1, t.length - 2)));
                        }
                    }else if(g.group){
                        let gFrag = emmet(t.substr(1, t.length - 2));
                        currentNode.appendChild(gFrag);
                    }else if(g.cal){

                    }else if(g.level){
                        if(g.level == '>'){
                            currentNode = currentNode.lastChild;
                        }else if(g.level == '^'){
                            currentNode = currentNode.parentNode;
                        }
                    }else if(g.tag){
                        currentNode.appendChild(d.createElement(t));
                    }else if(g.attr){
                        let kvStr = t.substr(1, t.length - 2).split(/[\'\"]+ /gi);
                        for(let i = 0; i < kvStr.length; i++){
                            let kv = kvStr[i].split('=');
                            currentNode.lastChild.setAttribute(kv[0], kv[1].replace(/[\"\']/gi, ''));
                        }
                    }

                    preToken = curToken;
                }

                return tree;
			}

			console.log(emmet('div>span{i am span}^p+(h1>span{span in group})+div#divId[title="title" class="class1 class2"]'));//div>(header>ul>li*2>a)+footer>p$*5>div+span+span{i am span}
		</script>
	</body>
</html>