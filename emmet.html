<!DOCTYPE html>
<html>
	<head>
		<title>Emmet</title>
	</head>
	<body>
    <p>Click </p><a href="">here</a> to continue<a href="qq.com"><span></span></a>
    <div></div>
    <a href="qq.com"><span></span></a>
    <div></div>
		<script type="text/javascript">
			function emmet(str) {
			    const keyToken = [
			        '>', // child
                    '+', // sibling
                    '^', // climb-up
                    '*', // multiplication
                    '(',
                    ')',
                    '#', // ID
                    '.', // class
                    '[',
                    ']', // attribute
                    '=', // in attribute
                    '$', // item numbering
                    '@',
                    '-', // changing numbering base and direction
                    '{',
                    '}' // text
                ];
				let tree = {children: [], parent: null};

				let token = '', currentNode = tree, tokenList = [];

				let charList = str.split('');

				for(let index = 0; index < charList.length; index++){
				    let char = charList[index];

                    if(keyToken.indexOf(char) > -1){ // 关键token
                        if(token != '' && keyToken.indexOf(str[index - 1]) < 0){ // 处理之前的普通token
                            tokenList.push(token);
                            token = '';
                        }

                        token = token + char;
                    }else{ // 普通token
                        if(str[index - 1] == '*'){ // 上一个是*，并且后面是数字
                            let num = '';
                            while(!isNaN(parseInt(str[index]))){
                                num += str[index];
                                index++;
                            }

                            if(num != ''){
                                token += num.toString();
                                index--;
                            }else{
                                throw '* must with number';
                            }
                            tokenList.push(token);
                            token = '';
                            continue;
                        }

                        if(token != '' && keyToken.indexOf(str[index - 1]) > -1){ // 处理之前的关键token
                            tokenList.push(token);
                            token = '';
                        }

                        token = token + char;
                    }
                }

                if(token != ''){
				    tokenList.push(token);
                }

                return tokenList;
			}

			const reg = 'p{Click }+a{here}+{ to continue}'.match(/({.+?})|([a-z]+)|(\$.*\*\d+?)|([\*>\+\^])|(\[.+?\])|(\(.+?\))/ig);

			console.log(emmet('ul>li*55>div'));
		</script>
	</body>
</html>